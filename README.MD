# API Brain Agriculture

## Vis√£o Geral

A **API Brain Agriculture** √© um servi√ßo backend projetado para gerenciar dados agr√≠colas, incluindo produtores, fazendas, culturas e colheitas. Constru√≠da com tecnologias modernas, oferece uma solu√ß√£o robusta e escal√°vel para rastreamento e an√°lise de atividades agr√≠colas, com foco em usabilidade e manutenibilidade.

## Arquitetura

A API segue uma arquitetura modular e em camadas, utilizando **NestJS**, um framework progressivo para Node.js, combinado com **TypeORM** para opera√ß√µes no banco de dados e **PostgreSQL** como banco de dados relacional.

## üß© Diagrama de Entidades (ERD)

```mermaid
erDiagram
  PRODUCER ||--o{ FARM : has
  FARM ||--o{ FARM_CROP_HARVEST : contains
  HARVEST ||--o{ FARM_CROP_HARVEST : includes
  CROP ||--o{ FARM_CROP_HARVEST : produces

  PRODUCER {
    int id PK
    string producer_name
    string cpf_cnpj
  }

  FARM {
    UUID id PK
    string farm_name
    string city
    string state
    float total_area
    float arable_area
    float vegetation_area
    UUID producerId FK
  }

  HARVEST {
    UUID id PK
    string harvest_name
  }

  CROP {
    UUID id PK
    string crop_name
  }

  FARM_CROP_HARVEST {
    UUID id PK
    UUID farmId FK
    UUID cropId FK
    UUID harvestId FK
  }
```

### Componentes Principais

- **Framework**: NestJS

  - Utiliza inje√ß√£o de depend√™ncias, estrutura modular e TypeScript para facilitar a manuten√ß√£o.
  - Organizada em m√≥dulos (`Producer`, `Farm`, `Harvest`, `Crop`, `FarmCropHarvest`, `Dashboard`) para separa√ß√£o de responsabilidades.
  - Exp√µe endpoints RESTful com documenta√ß√£o OpenAPI (Swagger) dispon√≠vel em `/api`.

- **Banco de Dados**: PostgreSQL com TypeORM

  - Gerencia entidades (`Producer`, `Farm`, `Harvest`, `Crop`, `FarmCropHarvest`) com UUIDs (via extens√£o `uuid-ossp`).
  - Usa migra√ß√µes para manter a consist√™ncia do esquema entre ambientes.
  - Suporta seeding para popular dados iniciais (e.g., produtores e fazendas de exemplo).
  - Configurado com SSL para conex√µes seguras em produ√ß√£o.

- **Implanta√ß√£o**: Railway com Docker
  - Implantada como uma aplica√ß√£o conteinerizada usando um `Dockerfile` multiest√°gio (Node.js 22 Alpine).
  - Hospedada na Railway, com uma inst√¢ncia gerenciada de PostgreSQL para persist√™ncia de dados.
  - Vari√°veis de ambiente (e.g., `DATABASE_URL`) configuram conex√µes de banco de dados de forma segura.
  - Migra√ß√µes s√£o executados automaticamente na inicializa√ß√£o do cont√™iner.

### Fluxo de Dados

1. Requisi√ß√µes HTTP chegam aos controladores do NestJS, que validam entradas e delegam √†s servi√ßos.
2. Os servi√ßos interagem com reposit√≥rios TypeORM para realizar opera√ß√µes CRUD no PostgreSQL.
3. O m√≥dulo `Dashboard` agrega dados para insights anal√≠ticos (e.g., m√©tricas de fazendas e colheitas).
4. Respostas s√£o formatadas como JSON, seguindo o esquema OpenAPI.

## Principais Funcionalidades

- **API REST**: Fornece endpoints para gerenciar entidades agr√≠colas (e.g., `/producers`, `/farms`, `/dashboard`).
- **Documenta√ß√£o Swagger**: Documenta√ß√£o interativa da API em `/api` para desenvolvedores.
- **Migra√ß√µes de Banco de Dados**: Garante atualiza√ß√µes consistentes do esquema com migra√ß√µes TypeORM.
- **Seeding**: Popula dados iniciais para testes e desenvolvimento.
- **Implanta√ß√£o Escal√°vel**: Executa na Railway com escalabilidade autom√°tica e PostgreSQL gerenciado.

## Configura√ß√£o e Implanta√ß√£o

### Link para onde est√° hospedada na Railway

[brainagriculture-production.up.railway.app](https://brainagriculture-production.up.railway.app/api/)

### Pr√©-requisitos

- Node.js 22
- Docker

### Vari√°veis de Ambiente

Configure nas vari√°veis do servi√ßo em um arquivo `.env` local seguindo modelo `.env.example`:

- DATABASE_URL=<endere√ßo do banco de dados **PostgreSQL**>

## Docker

Para rodar o container utilize: `docker-compose -f docker-compose.dev.yml up`

## Testes

Para rodar os testes utilize o comando:
`npm run test`
